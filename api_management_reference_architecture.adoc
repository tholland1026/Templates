= API Management:: Reference Architecture
:doctype: article
:author: CCI ATL - EDOEA-ApiManagement
:copyright: 2021 Cox Communications Inc.
:email: CCIATL-EDOEA-ApiManagement@cox.com
:title-page:
:title-logo-image: ./images/cox_logo.jpg
:revnumber: 2.0
:revdate: {docdate} 
:doctitle: AMS Reference Architecture
:title-separator: ::
:title: AMS Reference Architecture
:description: A reference architecture for API management.
:keywords: API AMS EDOEA EDOCA
:stem: latexmath
:math:
:experimental:
:source-highlighter: highlightjs
:highlightjs-theme: atom-one-dark
:highlightjsdir: highlight
:source-language: python
:listing-caption: Listing
:icons: font
:author: EDOEA-ApiManagement
:email: EDOEA-ApiManagement@cox.com
:appendix: 
:sectnums:
:sectnumlevels: 5
:toc: value
:toclevels: 5
ifndef::imagesdir[:imagesdir: ./images]
ifndef::diagramsdir[:diagramsdir: ./diagrams]
ifndef::tablesdir[:tablesdir: ./tables]
ifdef::backend-*html5*[]
:uri-kroki-server: https://kroki.ecs-east.corp.cox.com/
:imagesdir: ./images
:imagesoutdir: {imagesdir}
endif::[]
<<<
[[reference_architecture]]

[abstract]
© 2021 Cox Communications, Inc.  All rights reserved.
{nbsp} +
{nbsp} +
This documentation is the confidential and proprietary intellectual property of Cox Communications, Inc. Any unauthorized use, reproduction, preparation of derivative works, performance, or display of this document, or software represented by this document is strictly prohibited.
{nbsp} +
{nbsp} +
Cox Communications and the Cox Communications logo design are trademarks and/or service marks of Cox Enterprises, Inc. All other trademarks, service marks, and trade names are owned by their respective companies.

<<<

== Introduction
=== Purpose
The purpose of this document is to describe a reference architecture for an AMS (API Management
Solution). The purpose of the reference architecture is to provide a functional decomposition
of a comprehensive API management solution that has been designed in way that meets the business
objectives of our business. The term "Solution" is used here because the intention is not to limit
reference architecture to a single system or product.  Instead, the objective is account for the
reality that the goals and objectives may be met best by a suite of products and systems that
contain the desired features and capabilities.


* Provide a logical reference architecture for implementing an API management solution.
* Enumerate the components, features and capabilities that constitute a comprehensive solution by
which existing systems can be measured.

=== Audience
The intended audience for this document are architects, design and development teams as well as 
others who work with or otherwise support and maintain the AMS.

=== Objective
The objective of this document is to provide an AMS reference
architecture that:


* Enables the realization of the guiding principles for the AMS as described in the Guiding Principles
document, including:
** Self-Service API Consumption
** Automated API Publication
** Consistent API Security
** No Business Logic in the AMS
** Limit AMS to HTTPS Client/Server Transactions
** Simple Payload Translation Only
** Contract-First API Design
** Use AMS Internally and Externally
* Describes the key features and capabities of the ideal AMS.  
* Defines a set of constraints that an AMS must observe.
* Provides guidelines around when internal AMS should be used versus an external AMS.   

This reference architecture document is organized to define the seven architectural views for using 
an AMS such as Security, Application, Execution, Development, Data, Infrastructure and Operations. 
This document will:

* Define the logical architecture of an AMS
* Define the API security architecture to build a robust security model for authentication, authorization 
and any threat protection for APIs exposed using the AMS
* Define the architectural patterns and principles to be followed along with coding standards to be used 
for AMS implementations
* Define the high-level DevOps framework to manage the platform
* Define high availability design for the API gateway infrastructure for deployment
* Define the high level operational actions to manage the platform.


<<<

== Technology Landscape
=== Business Context
The  API management solution described in this document will provide a unified entry point for internal
and external consumers, independent of the number and composition of internal services/microservices. 
API management solutions provide additional capabilities such as analytics, security, resource isolation,
redundancy, developer self-service, and lifecycle management.  In order to benefit from the advanced 
features and capabilities of an API management solution, an enterprise organization must define and evolve
a comprehensive API strategy.  A comprehensive API strategy must include such considerations whether 
to limit API management to external partner integrations or to also use the API solution for integration 
within the organization.  Such a strategy should also encompass when the API management solution should 
be incorporated in a project solution or when a project solution should be exempted from mandatory API 
management adoption.  The API strategy should also contain a playbook for integration paths for leveraging 
both internal and external API gateways. Provisions for API management system behavior should include but is not 
limited to access control methodologies, data storage requirements and best practices, and business logic 
containment. API management solutions should define system architecture guidelines for redundancy, service isolation, health monitoring 
and alerting.  Due to the wide range of features commonly found in API management systems, the comprehensive 
API strategy should also define guidelines for adopting specific platform capabilities as well prohibit 
the use of features that are not aligned with business objectives.

<<<
=== AMS Capabilities
.Capability Map
image::capability_map.jpg[]

The above diagram outlines the key capabilities that the API Management Solution should fulfill. These align with the principles outlined in the API Management Principles document.

<<<
=== High Level Architecture
.Architecture
image::api_management_architecture.jpg[]

The API Management Solution will be the key integration point for the OSS, BSS and DSS applications to interact with each other. As described in the high level architecture diagram above, the API Management Solution will centralize the API security concern and also enforce rate limiting policies to prevent resource overloading. APIs will be onboarded to the AMS as API proxies that can be deployed using a multi tenant model. Each of these API proxies shall be accessible through an internal api gateway for all cox internal applications and also through an external api gateway for all Cox vendors/partners and external consumers. The API proxies should also have a capability to integrate with APIs deployed on cloud infrastructures in a secure and reliable manner.

The API Management Solution will have a management portal that caters to capabilities such as life cycle management, change management, analytics and monitoring.

The AMS will also provide capabilities to publish APIs into an API catalog that can be accessed through a developer portal. Developers will use Open API standards to define their API specs. These API specs will be maintained in a centralized API Spec Repository, which will be managed through the Developer Portal.

<<<
=== When to use API Management Solution
* APIs when consumed by more than one consumer should go through an internal/external API gateway
** Ex: App owners can take a quantitative approach. "Is my API going to be consumed by more than 1 Consumer?" If yes, the API should go through the API gateway.
* API consumers outside the Cox network will use the external API gateway to consume cox APIs.
* A Cox customer facing application can integrate with its backoffice using APIs published to an internal API gateway.
** Ex: A UI application wants to talk to APIs to get data that it needs to render. They may choose to go through the API Gateway and provide these APIs as a shared service.
* Message translation and/or aggregations.

==== When not to use an API Management Solution
* Intra application communication may choose to not publish the APIs to an AMS as long as there is no shared usage.
* Legacy applications that are sunsetting or are in a lights on mode may choose to not use the AMS.

[plantuml, api_decision_tree, svg]
[[decision_tree]]
.AMS Decision Tree
....
include::diagrams/ams_decision_tree.puml[]
....
The above decision tree helps determine if the AMS should be leveraged for a given scenario where an API needs to be consumed by an application.


=== API Management Solution
[plantuml, component, svg]
[[system_context]]
.API Management Solution (System Context Diagram)
....
include::diagrams/component.puml[]
....
The above diagram shows a high level system context diagram for the API Management Solution. The 
subsequent sections of this document will dive deeper into the system context of the API Management 
Solution and talk about the logical components that should help meet the architecture principles 
desribed in the <<api_management_architecture_principles, Principles>> document. 

==== Out of Scope
This document will focus on the system context from an API Management perspective. In the above system context diagram, Messaging Frameworks also play an important role in fulfilling the capability of inter application communication. However, Messaging as a topic will be out of scope for this document and will be dealt outside the context of the API Management reference architecture.

<<<
=== Logical Components of the Reference Architecture
The reference architecture doesn't take a specific API Gateway platform into 
consideration and provides a generic guidance that can be applied. Because each API Gateway 
platform is different, the reference architecture doesn't get into the details of the deployment
aspect of the solution. The infrastructure strategy and the network constraints are also out of 
scope for the purposes of this document.

[plantuml, component_level1, svg]
[[logical_components]]
.Logical Components of an API Management Solution
....
include::diagrams/component_level1.puml[]
....
The above diagram shows a logical view of the API Management Solution in the <<system_context>> and 
various components of the solution. Below are the key components and a high level overview of the 
functionality they provide.

* API Management
** Lifecycle Management
*** This includes how APIs are versioned and published for consumption. It will also talk about how 
APIs are deprecated.

** Change Management
*** Provides the capability to push changes and send availability and release notifications along with the
ability to deprecate APIs in production.

* API Gateway
** Application Security
*** Provides the capability to enforce various security principles of Authentication, Authorization,
Threat Detection and Traffic Management.
** Orchestration 
*** Provides the capability to perform routing, orchestration, mashups and message aggregation 
across two or more back-end services.
** Protocol Translation
*** Provides policies for the translation of protocols between the incoming request and backend services.
** Message Translation
*** Provides policies for performing message translation between different message formats and data models.

* Developer Portal
** Service Discovery
*** Provides the capability to expose an API Catalog that enables developers to discover and consume APIs.
** Developer Portal
*** Enables the following self-service capabilities:
**** Developer Registration
**** API Documentation
**** Community/Forums
**** API Sandbox for Testing. 


The logical components described above are broadly categorized into the following Capability Groups:

* Enable Developers
* Communicate Securely, Reliably and Flexibly
* Manage the API Lifecycle
* Measure and Improve Business Value

The following sections describe each of the capabilities in more details

==== Capability Group - Enable Developers
The goal of this capability group is to fulfill the "Self Service" principle of the API Management 
Reference Architecture. Self Service is achieved through Service Discovery and Developer Portal 
components of the reference architecture.

===== Service Discovery
====== API Catalog
The API Management Solution will provide an API Catalog for API consumers. API Consumers should 
have the ability to on-board and browse through the API Catalog to discover the APIs that are offered
with suitable metadata and documentation for their use. The API Catalog can be further divided into
two categories depending on whether the API consumers are internal or external. The Public API 
Catalog would be available for all external consumers and a Private/Internal API Catalog would be made
available for internal use.

===== Developer Portal
====== API Publication and API Sandbox
The API Management Solution will integrate with the continous delivery DevOps pipeline, to automate the 
publishing of API artifacts to the internal and the external API Catlog. These should be generated 
from a standard format such as Open API YAML specifications.

The API Management Solution will also provide a sandbox that will live in an isolated area segregated from
the live environment to allow for safe experimentation, implementing proof of concepts, developing and
testing by developers.

====== Documentation and Document Manager
The API developer portal will allow release notes and documentation to be made available to developers.
The documentation can be a combination of traditional documents and generated documents from tools like
swagger.

<<<

== Glossary
AMS:: API Management Solution refers to the processes for distributing, controlling, and analyzing the APIs that connect applications and data across the enterprise. +
The goal of API management is to allow organizations that create APIs or use others’ APIs to monitor activity and ensure the needs of the developers and applications using the API are being met.

Business Logic:: Business logic is the custom rules that handle the exchange of information between a database and user interface. +
Business logic is essentially the part of a computer program that contains the information (in the form of business rules) that defines or constrains how a business operates.

Orchestration:: Orchestration is the automated configuration, management, and coordination of computer systems, applications, and services. +
Orchestration helps IT to more easily manage complex tasks and workflows.
